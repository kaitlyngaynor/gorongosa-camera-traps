# Gorongosa Camera Trap Analysis

DATA CLEANING

**CamtrapR.R**: Generate record table from raw photos that have been sorted into folders by species (used in many of the scripts below); generate species-specific detection matrices for later use in Occupancy_matrix_wrangling.Rmd

Time_shift.R: Change date and time metadata associated with image files; to do before generating record table in camtrapR
* Need a spreadsheet with the time corrections for all camera folders that must be edited

Gorongosa_GIS.Rmd: Compile and clean spatial vector and raster layers, and extract values at camera locations.
* Input
    * A number of GIS layers
    * Spreadsheet with camera latitude and longitude (Camera_coordinates.csv)
* Crop, change resolution/extent, convert vector to raster, create raster stack
* Calculate distance to features
* Calculate neighborhood raster values
* Output
    * Spreadsheet with extracted raster values at camera locations (cam_metadata_102518.csv)

Occupancy_matrix_wrangling.Rmd: Generate summarized occupancy records for different time periods in the format necessary for analysis using Lindsey’s code
* Input
    * Master file with a row for each camera-species, and column for each date, with 0, 1, and NA for non-detection, detection, and inoperability. I believe I created this file by compiling individual species matrices from camtrapR but don’t have the code (All_species_by_date_062316_090417.csv)
* Subsets by dates of interest
* Sum “1” columns to calculate total number of sampling periods with detections, spread data so there is one column per species and one row per camera
* Count “0” and “1” columns to calculate total number of nights that each camera was operational
* Output
    * Detection counts for each species at each camera (ex. Detections_7_1_16_9_30_16.csv)
    * Camera operation for each camera (ex. Camoperation_7_1_16_9_30_16.csv)

Recordtable_all_to_15min.R: Cleans master record table, eliminating records that are outside of camera operation and reducing to “independent” records 
* Input
    * Complete record table with all detections (generated by camtrapR, columns for elapsed time) (Gaynor_ALLrecords_cleaned_June16_to_June17.csv)
    * Camera metadata with columns with dates for Start, End, Problem1_From, Problem1_To (optional) (cam_metadata_all.csv)
* Output
    * Record table that only includes detections separated by a given interval (here, I did 15 min, but could be easily changed), during period of camera operation (Gaynor_15min_records_June2016_to_June2017.csv)
    * Can be brought into RAI_calculation.R to calculate RAI

RAI_calculation.R: Calculates RAI for each species at each camera from the record table for a given time period.
* Input
    * Cleaned record table (generated by Recordtable_all_to_15min.R) with only independent records (Gaynor_15min_records_June2016_to_June2017.csv)
    * Camera operation dates for time period of interest, created by Occupancy_matrix_wrangling.Rmd (ex. Camoperation_7_1_16_9_30_16.csv) - column that has the number of trap-nights for each camera in that season
* Removes species that are not to be included in analysis (incl. Ghost)
* Subsets record table to time period of interest (after you input start and end dates)
* Calculates number of records of each species at each camera
* Calculates RAI based on number of records and operation date
* Currently written for dry, wet3mo, wet4mo - will need to edit if 
* Output
    * Table for each season, with columns for species, camera, operation, count, and RAI (ex. RAI_peakdry.csv)

SIF_DataGrab.R: reformats detection and operation matrices for pairwise species interaction factor modeling (from Lindsey)
* Input
    * Detection and operation matrices (as generated by Occupancy_matrix_wrangling.Rmd)
* Output
    * Spreadsheet of species pair co-occurrence data ready for SIF analysis using CoOcc_Code.R (ex. Dry.peak.SppPairs.csv)

sunrisesunset_season.R: assigns time of day and season to each record, based on date and time
* Script written for elephant activity pattern paper
* Input
    * Record table from camtrapR
    * Information on daily sunrise and sunset time, which I downloaded from a NOAA (?) spreadsheet - sunrise_sunset.csv
* Compares the time to sunrise/sunset on that date to assign day or night
    * Uses mutate function rather than a for loop, hmm! Could be worth bringing into future code
* Output
    * Record table with columns for time period and season (ex. Record_table_all_1hr_timeperiods.csv)

RCode_FixAllData_20180717.R: written by Lynn, gets record table into format with one row per burst (to account for differences in sorting method between seasons)
* Input and output are both record tables

DATA ANALYSIS

Covariate_correlations.R: calculates correlations among variables
* Input
    * Camera metadata file (cam_metadata_master.csv)
* Determines Pearson’s r coefficients and p-values for relationships between each of covariates
* Worth revisiting!
* Output - none (but could export the correlation matrix)

Gorongosa_RAI_analysis.Rmd: Variety of analyses related to RAI, in progress
* Input
    * RAI data files from RAI_calculation.R (ex. RAI_peakdry.csv)
* Variety of analyses on RAI
* In progress...

Gorongosa_occupancy.Rmd: Lindsey’s occupancy models
* Input
    * Detection histories for each species at each camera, plus camera operation days for each camera (from Occupancy_matrix_wrangling.Rmd)
    * Camera locations (2018camloc.csv) - tbh not sure what this ends up being used for?
    * Species information (2018spp.csv) - for grouping species for analysis
    * Camera metadata (cam_metadata_master.csv) - for pulling out occupancy and detection covariates
* Runs multi-species hierarchical occupancy models with specified covariates for occupancy and detection
* Output - various files with occupancy, detection means and CIs for different groups/species, modeled species richness, etc.

Occupancy_covariate_comparison.R: for exploring the effects of individual covariates on overall occupancy (Lindsey’s suggested method for Bayesian "model selection")
* Input
    * D and G spreadsheets (intermediate outputs from Occupancy.R
* Essentially does what Occupancy.R does, but with just one detection covariate, and only exports community-level hyperparameters
* Output
    * Community-level hyperparameter - coefficient corresponding to effect of the predictor variable on occupancy (mean, SD, upper and lower CIs)
 
Occupancy_covariate_comparison_pt2.R: for exploring the effects of individual covariates on overall occupancy (Lindsey’s suggested method for Bayesian "model selection")
* Input
    * Individual spreadsheets for the community coefficient model output (outputs from Occupancy_covariate_comparison.R

CoOcc_Code.R: Species Interaction Factor (SIF) model, code from Lindsey
* Input
    * Species pair detection information - from SIF_DataGrab.R (ex. Dry.peak.SppPairs.csv)
* Output
    * SIF results, with columns for psiA (probability A occurred in study area), psiBA (probability of B given A), psiBa (probability of B given A), psiB (derived quantity from the other values), pA (A detection probability), pB (B detection probability) - ex. SIF_2018Dry.csv

SIF_analysis2_11_2018.Rmd: Analyses related to SIF, in progress
* Input
    * SIF results from CoOcc_Code.R (ex. SIF_2018Dry.csv)
* 
* To add code on network figures - adapt from what I wrote over the summer, in Archive folder: SIF_network_figures_June18

Temporal_overlap.R: Calculates pairwise temporal (24-hr) overlap between all pairs of species, using overlap package.
* Input - record table
* Output - long data matrix with pairwise overlap values for all 703 species pairs, with columns for overlap in dry, wet3mo, and wet4mo seasons

Occupancy exploration - to write!
* Can draw on Archived Figures_occ_Det.R and Figures_covariates_040518.R from my lab meeting
